## StegaStampp: Invisible Hyperlinks in Physical Photographs [[Project Page]](http://www.matthewtancik.com/stegastamp)

## Installation
- Install tensorflow (tested with tf 1.13)
- Download dependencies
```bash=
pip install -r requirements.txt
```
- Clone repo and install submodules
```bash=
git clone --recurse-submodules https://github.com/tancik/StegaStamp.git
cd StegaStamp
```

## Training
### Encoder / Decoder
- Set dataset path in train.py
```
TRAIN_PATH = DIR_OF_DATASET_IMAGES
```

- Train model
```bash=
bash scripts/base.sh EXP_NAME
```
The training is performed in `train.py`. There are a number of hyperparamters, many corresponding to the augmentation parameters. `scripts/bash.sh` provides a good starting place.

#### Pretrained network
Run the following to download the trained network used in paper
```bash=
wget http://people.eecs.berkeley.edu/~tancik/stegastamp/saved_models.tar.xz
tar -xJf saved_models.tar.xz
rm saved_models.tar.xz
```

### Detector
The training code for the detector model (used to segment StegaStamps) is not included in this repo. The model used in the paper was trained using BiSeNet model released [here](https://github.com/GeorgeSeif/Semantic-Segmentation-Suite). The CROP_WIDTH and CROP_HEIGHT were set to 1024, all over parameters were the default. The dataset was generated by randomly placeing warped StegaStamps onto images.

The exported detector model can be downloaded with the following command.
```bash=
wget http://people.eecs.berkeley.edu/~tancik/stegastamp/detector_models.tar.xz
tar -xJf detector_models.tar.xz
rm detector_models.tar.xz
```

### Tensorboard
To visualize the training run the following command and navigate to http://localhost:6006 in your browser.
```bash=
tensorboard --logdir logs
```

## Encoding a Message
The script `encode_image.py` can be used to encode a message into an image or a directory of images. The default model expects a utf-8 encoded secret that is <= 7 characters (100 bit message -> 56 bits after ECC).

Encode a message into an image:
```bash=
python encode_image.py saved_models/stegastamp_pretrained --image test_im.png  --save_dir out/ --secret Hello
```
This will save both the StegaStamp and the residual that was applied to the original image.

## Decoding a Message
The script `decode_image.py` can be used to decode a message from a StegaStamp.

Example usage:
```bash=
python decode_image.py saved_models/stegastamp_pretrained --image out/test_hidden.png
```

## Detecting and Decoding
The script `detector.py` can be used to detect and decode StegaStamps in an image. This is useful in cases where their are multiple StegaStamps are present or the StegaStamp does not fill the frame of the image.

To use the detector, make sure to download the detector model as described in the installation section.

```bash=
python detector.py --detector_model detector_models/stegastamp_detector --decoder_model saved_models/stegastamp_pretrained --video test_vid.mp4
```
Use the `--save_video FILENAME` flag to save out the results.
